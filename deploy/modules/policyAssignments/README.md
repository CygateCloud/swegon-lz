# Module: Policy Assignments Management group

This module deploys Azure Policy Assignments to a specified Management Group and also assigns the relevant RBAC for the system-assigned Managed Identities created for policies that require them (e.g DeployIfNotExist & Modify effect policies).

## Update module image

```powershell
Publish-AzBicepModule `
-FilePath infra-as-code\bicep\modules\policy\assignments\policyAssignmentManagementGroup.bicep `
-Target br:ccdregistryprod.azurecr.io/bicep/modules/azurefoundation/policyassignmentmanagementgroup:v1.0
```

## Parameters

> Please use the scroll horizontal scroll bar at the bottom of this table to scroll along to see the other columns!

The module requires the following inputs:

<!-- markdownlint-disable -->
 | Parameter                                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Requirement                                                                                                                                                                                                                                  | Example                                                                                                                                                                                                                                      | Default Value |
 | ------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- |
 | parPolicyAssignmentName                                 | The name of the policy assignment.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Mandatory input. Can only be a maximum of 24 characters in length as per: [Naming rules and restrictions for Azure resources](https://docs.microsoft.com/azure/azure-resource-manager/management/resource-name-rules#microsoftauthorization) | `Deny-Public-IP`                                                                                                                                                                                                                             | None          |
 | parPolicyAssignmentDisplayName                          | The display name of the policy assignment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Mandatory input                                                                                                                                                                                                                              | `Deny the creation of Public IPs`                                                                                                                                                                                                            | None          |
 | parPolicyAssignmentDescription                          | The description of the policy assignment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Mandatory input                                                                                                                                                                                                                              | `This policy denies creation of Public IPs under the assigned scope.`                                                                                                                                                                        | None          |
 | parPolicyAssignmentDefinitionID                         | The policy definition ID (full resource ID) for the policy to be assigned.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Mandatory input                                                                                                                                                                                                                              | `/providers/Microsoft.Authorization/policyDefinitions/9d0a794f-1444-4c96-9534-e35fc8c39c91` (built-in) or `/providers/Microsoft.Management/managementgroups/alz/providers/Microsoft.Authorization/policyDefinitions/Deny-Public-IP` (custom) | None          |
 | parPolicyAssignmentParameters                           | An object containing the parameter values for the policy to be assigned.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Mandatory input                                                                                                                                                                                                                              | `{"value":{"emailSecurityContact":{"value":"security_contact@replace_me"}}}`                                                                                                                                                                 | `{}`          |
 | parPolicyAssignmentParameterOverrides                   | An object containing parameter values that override those provided to parPolicyAssignmentParameters, usually via a JSON file and json(loadTextContent(FILE_PATH)). This is only useful when wanting to take values from a source like a JSON file for the majority of the parameters but override specific parameter inputs from other sources or hardcoded. If duplicate parameters exist between parPolicyAssignmentParameters & parPolicyAssignmentParameterOverrides, inputs provided to parPolicyAssignmentParameterOverrides will win. | Not mandatory                                                                                                                                                                                                                                | `{"value":{"emailSecurityContact":{"value":"different_contact@replace_me"}}}`                                                                                                                                                                | `{}`          |
 | parPolicyAssignmentNonComplianceMessages                | An array containing object/s for the non-compliance messages for the policy to be assigned. See [Non-compliance messages](https://docs.microsoft.com/azure/governance/policy/concepts/assignment-structure#non-compliance-messages) for more details on use.                                                                                                                                                                                                                                                                                 | Mandatory input                                                                                                                                                                                                                              | `[{"message":"Default message"}]`                                                                                                                                                                                                            | `[]`          |
 | parPolicyAssignmentNotScopes                            | An array containing a list of scope Resource IDs to be excluded for the policy assignment.                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Mandatory input                                                                                                                                                                                                                              | `["/providers/Microsoft.Management/managementgroups/alz","/providers/Microsoft.Management/managementgroups/alz-sandbox"]`                                                                                                                    | `[]`          |
 | parPolicyAssignmentEnforcementMode                      | The enforcement mode for the policy assignment. See [Enforcement Mode](https://aka.ms/EnforcementMode) for more details on use.                                                                                                                                                                                                                                                                                                                                                                                                              | Not mandatory. Will only allow values of `Default` or `DoNotEnforce`                                                                                                                                                                         | `Default`                                                                                                                                                                                                                                    | `Default`     |
 | parPolicyAssignmentIdentityType                         | The type of identity to be created and associated with the policy assignment. Only required for `Modify` and `DeployIfNotExists` policy effects                                                                                                                                                                                                                                                                                                                                                                                              | Not mandatory. Will only allow values of `None` or `SystemAssigned`                                                                                                                                                                          | `None`                                                                                                                                                                                                                                       |
 | parPolicyAssignmentIdentityRoleAssignmentsAdditionalMGs | An array containing a list of additional Management Group IDs (as the Management Group deployed to is included automatically) that the System-assigned Managed Identity, associated to the policy assignment, will be assigned to additionally.                                                                                                                                                                                                                                                                                              | Not mandatory                                                                                                                                                                                                                                | `["alz","alz-sandbox"]`                                                                                                                                                                                                                      | `[]`          |
 | parPolicyAssignmentIdentityRoleAssignmentsSubs          | An array containing a list of Subscription IDs that the System-assigned Managed Identity associated to the policy assignment will be assigned to in addition to the Management Group the policy is deployed/assigned to.                                                                                                                                                                                                                                                                                                                     | Not mandatory                                                                                                                                                                                                                                | `["d4417fe6-3370-48e2-ab38-c7b926526fe7","fbec3ec1-292a-4207-831c-bd62fdb7b468"]`                                                                                                                                                            | `[]`          |
 | parPolicyAssignmentIdentityRoleDefinitionIDs            | An array containing a list of RBAC role definition IDs to be assigned to the Managed Identity that is created and associated with the policy assignment. Only required for `Modify` and `DeployIfNotExists` policy effects                                                                                                                                                                                                                                                                                                                   | Not mandatory. But required for a `Modify` and `DeployIfNotExists` policy effect assignment.                                                                                                                                                 | `alz`                                                                                                                                                                                                                                        | `[]`          |
<!-- markdownlint-restore -->
